<section class="mat-typography">
  <header class="header">
    <mat-grid-list cols="1" rowHeight="100px">
        <h1>Welcome to TinyTasks!</h1>
    </mat-grid-list>
    <mat-grid-list cols="2" rowHeight="100px">
      <mat-grid-tile>
        <mat-form-field class="example-full-width">
          <input matInput placeholder="Add task" #taskInput (keyup.enter)="add(taskInput.value)">
        </mat-form-field>
      </mat-grid-tile>
      <mat-grid-tile>
        <tiny-priority [priority]="taskInput.priority" (priorityChanged)="onPrioritySet($event)"></tiny-priority>
      </mat-grid-tile>
    </mat-grid-list>
    <mat-grid-list cols="4" rowHeight="100px">
      <mat-grid-tile>
        <button mat-button color="primary" (click)="add(taskInput.value)">Add</button>
      </mat-grid-tile>
      <mat-grid-tile>
        <button mat-button color="warn" (click)="clear()">Clear</button>
      </mat-grid-tile>
      <mat-grid-tile>
          <tiny-search [query]="taskInput.value" (filteredList)="onFiltered($event)"></tiny-search>
      </mat-grid-tile>
      <mat-grid-tile>
          <button mat-button color="warn" (click)="sortByPriority()">Sort</button>
        </mat-grid-tile>
    </mat-grid-list>
  </header>
  <section *ngIf="taskService?.tasks.length > 0">
    <ul>
      <li *ngFor="let task of taskService.tasks" [class.completed]="task.completed" [class.editing]="task.editing">
        <div class="view">
          <input class="toggle" type="checkbox" (click)="complete(task)" [checked]="task.completed">
          <label (dblclick)="activateEdit(task)">{{task.value}}</label>
          &nbsp;
          <label (dblclick)="activateEdit(task)">Priority: {{task.priority}}</label>
          <button mat-icon-button>
            <mat-icon aria-label="Delete task" (click)="remove(task)" *ngIf="!filteredList?.length > 0">delete
            </mat-icon>
          </button>
        </div>
        <input matInput class="edit" *ngIf="task.editing" 
          [value]="task.value" #editedtask
          (blur)="stopEditing(task, editedtask.value)" 
          (keyup.enter)="updateTask(task, editedtask.value)"
          (keyup.escape)="cancelEditing(task)">
        <tiny-priority  *ngIf="task.editing" 
          (keyup.escape)="cancelEditing(task)"
          (blur)="stopEditing(task, editedtask.value)"
          [priority]="task.priority" #editedtask 
          (priorityChanged)="onPrioritySet($event)">
        </tiny-priority>
      </li>
    </ul>
  </section>

  <footer class="footer" *ngIf="taskService?.tasks.length > 0 && !filteredList?.length > 0">
    <span class="task-count"><strong>{{taskService.getRemainingList().length}}</strong>
      {{taskService.getRemainingList().length == 1 ? 'item' : 'items'}} left</span>
    <button mat-button color="warn" *ngIf="taskService.getCompletedList().length > 0"
      (click)="taskService.removeCompleted()">Clear completed</button>
  </footer>
</section>